name: app

type: php:8.2

build:
    flavor: composer

dependencies:
    php:
        composer/composer: '^2'

relationships:
    database: "database:mysql"

web:
    locations:
        "/":
            root: "appractic.so/public"
            index:
                - index.php
            scripts:
                - auto_prepend_file: null
            allow: true
            passthru: "/index.php"

disk: 2048

mounts:
    'appractic.so/storage/app/public':
        source: local
        source_path: 'public'
    'appractic.so/storage/framework/views':
        source: local
        source_path: 'views'
    'appractic.so/storage/framework/sessions':
        source: local
        source_path: 'sessions'
    'appractic.so/storage/framework/cache':
        source: local
        source_path: 'cache'
    'appractic.so/storage/logs':
        source: local
        source_path: 'logs'
    'appractic.so/bootstrap/cache':
        source: local
        source_path: 'cache'

hooks:
    build: |
        set -e
        composer install --no-interaction --prefer-dist --optimize-autoloader
        cd appractic.so
        composer install --no-interaction --prefer-dist --optimize-autoloader
        php artisan optimize:clear
        php artisan config:clear
        php artisan cache:clear
        php artisan view:clear
        php artisan storage:link
    deploy: |
        cd appractic.so
        php artisan migrate --force
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache
